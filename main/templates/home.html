{% load static i18n %}
<!DOCTYPE html>
{% get_current_language as LANGUAGE_CODE %}
<html lang="{{ LANGUAGE_CODE }}">
<head>
    <meta charset="UTF-8" />
    <title>{% trans "Chokdee Thai Massage" %}</title>
    <link rel="stylesheet" href="{% static 'css/home.css' %}">
</head>

<body>

    <!-- Navbar -->
    <nav class="navbar">
        <div class="nav-container">

            <img src="{% static 'images/logo.png' %}" alt="{% trans 'Logo' %}" class="logo">

            <ul class="nav-menu">
                <li><a href="{% url 'home' %}">{% trans "Home" %}</a></li>
                <li><a href="{% url 'massages' %}">{% trans "Massages" %}</a></li>
                <li><a href="{% url 'price' %}">{% trans "Price" %}</a></li>
                <li><a href="{% url 'promotion' %}">{% trans "Promotion" %}</a></li>
                <li><a href="{% url 'gallery' %}">{% trans "Gallery" %}</a></li>
                <li><a href="{% url 'team' %}">{% trans "Team" %}</a></li>
                <li><a href="{% url 'contact' %}">{% trans "Contact" %}</a></li>
            </ul>

            <!-- Admin Button -->
            <div class="admin-btn">
                <a href="/adminx/">
                    <img src="{% static 'images/icon_user.jpg' %}" alt="{% trans 'Admin' %}" class="admin-icon">
                </a>
            </div>

        </div>

        <!-- Language Flags (prefix redirect) -->
        <div class="lang-flags">
            <form action="{% url 'set_language' %}" method="post" style="display:inline">
                {% csrf_token %}
                <input type="hidden" name="language" value="th">
                <input type="hidden" name="next" value="{{ request.get_full_path }}">
                <button type="submit" class="flag-btn" title="à¸ à¸²à¸©à¸²à¹„à¸—à¸¢">
                    <img src="{% static 'images/flag_thai.png' %}" alt="TH" class="flag">
                </button>
            </form>
            <form action="{% url 'set_language' %}" method="post" style="display:inline">
                {% csrf_token %}
                <input type="hidden" name="language" value="en">
                <input type="hidden" name="next" value="{{ request.get_full_path }}">
                <button type="submit" class="flag-btn" title="English">
                    <img src="{% static 'images/flag_uk.png' %}" alt="EN" class="flag">
                </button>
            </form>
            <form action="{% url 'set_language' %}" method="post" style="display:inline">
                {% csrf_token %}
                <input type="hidden" name="language" value="de">
                <input type="hidden" name="next" value="{{ request.get_full_path }}">
                <button type="submit" class="flag-btn" title="Deutsch">
                    <img src="{% static 'images/flag_de.png' %}" alt="DE" class="flag">
                </button>
            </form>
        </div>
    </nav>

    {% if request.user.is_staff %}
        <li><a href="{% url 'employee_list' %}">{% trans "Manage" %}</a></li>
    {% endif %}

    <!-- Banner Section -->
    <section>
        <img src="{% static 'images/chokdee_banner.jpg' %}" alt="{% trans 'Chokdee Thai Massage' %}">
        <div class="info-box">
            <h1 class="title">{% trans "CHOKDEE THAI MASSAGE" %}</h1>
            <p class="subtitle">{% trans "Opening hours" %}</p>
            <p class="subtitle">{% trans "By appointment only" %}</p>
            <p class="subtitle">{% trans "Monday â€“ Sunday" %}</p>
            <p class="subtitle">09.00 - 19.00</p>
        </div>
    </section>

    <!-- Register Button -->
    <div class="register-section">
        <a href="{% url 'customer_register' %}" class="register-btn">{% trans "Register" %}</a>
    </div>

    <!-- Schedule Section -->
    <section class="team-showcase">
        <div class="container schedule-frame">

            <div class="schedule-title">
                <div class="schedule-box">
                    <h1>{% trans "Schedule" %}</h1>
                </div>
            </div>

            <div class="staff-gallery">
                {% for e in employees %}
                    <article class="staff-card">
                        <figure class="staff-photo-frame">

                            {% if e.photo_url %}
                                <a href="{% url 'employee_calendar' e.id %}">
                                    <img src="{{ e.photo_url }}" alt="{{ e.display_name }}">
                                </a>
                            {% else %}
                                <a href="{% url 'employee_calendar' e.id %}">
                                    <img src="{% static 'images/placeholder.png' %}" alt="{{ e.display_name }}">
                                </a>
                            {% endif %}

                        </figure>
                        <div class="staff-name">{{ e.display_name|upper }}</div>
                    </article>

                {% empty %}
                    <p class="muted">{% trans "No employees available" %}</p>
                {% endfor %}
            </div>

        </div>
    </section>

    <!-- Map Section -->
    <section class="map-section">
        <div class="map-wrapper">
            <div class="title-box">
                <h1>{% trans "CHOKDEE THAI MASSAGE" %}</h1>
            </div>

            <div class="map-card">
                <iframe
                    src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d2785.135838640763!2d17.186348!3d46.789773!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x476910dbf8eeab7b%3A0x8675b098e284fea4!2sChokdee%20Thai%20Massage%20in%20H%C3%A9v%C3%ADz!5e0!3m2!1sth!2shu!4v1721467100000!5m2!1sth!2shu"
                    allowfullscreen
                    loading="lazy"
                    referrerpolicy="no-referrer-when-downgrade">
                </iframe>
            </div>
        </div>
    </section>

    <!-- Address -->
    <section class="address-box">
        <div class="address-container">
            <a href="https://www.google.com/maps/place/Chokdee+Thai+Massage+in+H%C3%A9v%C3%ADz/" target="_blank">
                {% trans "8380 HÃ©vÃ­z, RÃ¡kÃ³czi utca 10. Tel: +36 30 581 4854" %}
            </a>
        </div>
    </section>

    <!-- Chat Button -->
    <div id="chat-button"
        style="position:fixed; bottom:20px; right:20px; background:#3B7A57; color:white; border-radius:50%;
               width:60px; height:60px; display:flex; justify-content:center; align-items:center;
               font-size:24px; cursor:pointer; z-index:1000;">
        ðŸ’¬
    </div>

    <!-- Chat Box -->
    <div id="chat-box"
        style="display:none; position:fixed; bottom:90px; right:20px; width:300px; height:400px;
               background:white; border:1px solid #ccc; border-radius:10px;
               box-shadow:0 4px 8px rgba(0,0,0,0.2); z-index:1000;">

        <div style="background:#3B7A57; color:white; padding:10px; border-radius:10px 10px 0 0;">
               Chokdee Thai Massage
        </div>

        <div id="chat-messages" style="height:300px; overflow-y:auto; padding:10px; font-size:14px;"></div>

        <div style="display:flex; border-top:1px solid #ddd;">
            <input id="chat-input" type="text" placeholder="{% trans 'Type a message...' %}"
                   style="flex:1; padding:8px; border:none; outline:none;">
            <button onclick="sendMessage()"
                    style="padding:8px 12px; background:#3B7A57; color:white; border:none;">
                {% trans "Send" %}
            </button>
        </div>
    </div>

    <!-- Chat Script -->
    <script>
        document.getElementById("chat-button").onclick = function () {
            const box = document.getElementById("chat-box");
            box.style.display = (box.style.display === "none") ? "block" : "none";
        };

        async function sendMessage() {
            const input = document.getElementById("chat-input");
            const message = input.value.trim();
            if (!message) return;

            const messagesDiv = document.getElementById("chat-messages");
            messagesDiv.innerHTML += `<div><b>{% trans "You" %}:</b> ${message}</div>`;
            input.value = "";

            const formData = new FormData();
            formData.append("message", message);

            const response = await fetch("{% url 'chat_api' %}", {
                method: "POST",
                body: formData
            });

            const data = await response.json();

            if (data.reply) {
                messagesDiv.innerHTML += `<div style="color:green;"><b>{% trans "Bot" %}:</b> ${data.reply}</div>`;
            } else {
                messagesDiv.innerHTML += `<div style="color:red;"><b>{% trans "Error" %}:</b> ${data.error}</div>`;
            }

            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }
    </script>

</body>
</html>
