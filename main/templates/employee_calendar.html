{% load static %}
<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <title>ตารางงาน - {{ emp.display_name }}</title>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.css">

    <style>
        body {
            background: #e8f0ec;
            font-family: 'Kanit', sans-serif;
        }
        .calendar-container {
            max-width: 900px;
            margin: 40px auto;
            padding: 30px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        .btn-back {
            padding: 10px 20px;
            background: #1d7f43;
            color: white;
            border-radius: 8px;
            text-decoration: none;
        }
        .btn-back:hover {
            background: #146234;
        }
        .modal-box {
            padding: 20px;
            text-align: center;
        }
        .modal-btn {
            width: 100%;
            padding: 15px;
            font-size: 18px;
            background: #1d7f43;
            color: white;
            border-radius: 8px;
            border: none;
            cursor: pointer;
        }
        .modal-btn:hover {
            background: #146234;
        }

        /* ---------- NEW MODAL FIX ---------- */
        .modal-overlay {
            display: none; /* ปิดตอนเริ่มต้น */
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 9999;

            /* จัดกลาง */
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background: white;
            width: 90%;
            max-width: 400px;
            padding: 25px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            animation: fadeIn 0.2s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.95); }
            to   { opacity: 1; transform: scale(1); }
        }
    </style>

</head>
<body>

<div class="calendar-container">

    <a href="{% url 'home' %}" class="btn-back">← กลับหน้าแรก</a>

    <h2 style="text-align:center; margin-top:20px;">
        ตารางงานของ {{ emp.display_name }}
    </h2>

    <div id="calendar" style="margin-top: 20px;"></div>
</div>


<!-- ---------- MODAL (เวอร์ชันใหม่ ทำงานถูกต้อง) ---------- -->
<div id="dayModal" class="modal-overlay">
    <div class="modal-content">
        <div class="modal-box">
            <h3>ตารางวันที่ <span id="selected_date"></span></h3>

            <button id="goBooking" class="modal-btn" style="margin-top:20px;">
                จองออนไลน์
            </button>

            <button onclick="closeModal()" class="modal-btn" style="margin-top:10px; background:#888;">
                ปิด
            </button>
        </div>
    </div>
</div>


<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>

<script>
document.addEventListener('DOMContentLoaded', function () {

    let emp_id = "{{ emp.id }}";

    let calendarEl = document.getElementById('calendar');

    let calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: 'dayGridMonth',
        selectable: true,

        dateClick: function(info) {
            // เปิด modal แบบ flex
            document.getElementById("selected_date").innerText = info.dateStr;
            document.getElementById("dayModal").style.display = "flex";
        },

        events: `/employees/${emp_id}/events/`
    });

    calendar.render();

    // ไปหน้า booking-slot
    document.getElementById("goBooking").addEventListener("click", function () {
        let date = document.getElementById("selected_date").innerText;

        if (!date) {
            alert("กรุณาเลือกวันที่ก่อน");
            return;
        }

        window.location.href = `/booking-slots/${emp_id}/?date=${date}&duration=60`;
    });

});

// ปิด Modal
function closeModal() {
    document.getElementById("dayModal").style.display = "none";
}
</script>

</body>
</html>
